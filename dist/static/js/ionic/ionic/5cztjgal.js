/*!
 * (C) Ionic http://ionicframework.com - MIT License
 * Built with http://stenciljs.com
 */
const{h:e}=window.Ionic;import{a as t}from"./chunk-ab2696b0.js";import{d as i}from"./chunk-770a6cdb.js";import{a as s,b as n}from"./chunk-fe7f197d.js";class r{constructor(e,t){this.component=e,this.params=t,this.state=1}async init(e){if(this.state=2,!this.element){const i=this.component;this.element=await t(this.delegate,e,i,["ion-page","hide-page"],this.params)}}_destroy(){this.state;const e=this.element;e&&(this.delegate?this.delegate.removeViewFromDom(e.parentElement,e):e.remove()),this.nav=void 0,this.state=3}}function o(e,t,i){if(!e)return!1;if(e.component!==t)return!1;const s=e.params,n=null==s,r=null==i;if(n!==r)return!1;if(n&&r)return!0;const o=Object.keys(s),a=Object.keys(i);if(o.length!==a.length)return!1;for(let e=0;e<o.length;e++){const t=o[e];if(s[t]!==i[t])return!1}return!0}function a(e,t){return e?e instanceof r?e:new r(e,t):null}class h{constructor(){this.transInstr=[],this.useRouter=!1,this.isTransitioning=!1,this.destroyed=!1,this.views=[]}rootChanged(){this.root&&(this.useRouter||this.setRoot(this.root,this.rootParams))}componentWillLoad(){this.useRouter=!!this.win.document.querySelector("ion-router")&&!this.el.closest("[no-router]"),void 0===this.swipeBackEnabled&&(this.swipeBackEnabled=this.config.getBoolean("swipeBackEnabled","ios"===this.mode)),void 0===this.animated&&(this.animated=this.config.getBoolean("animate",!0)),this.ionNavWillLoad.emit()}componentDidLoad(){this.rootChanged()}componentDidUnload(){for(const e of this.views)s(this.win,e.element,"ionViewWillUnload"),e._destroy();this.sbTrns&&this.sbTrns.destroy(),this.transInstr.length=this.views.length=0,this.sbTrns=void 0,this.destroyed=!0}push(e,t,i,s){return this.queueTrns({insertStart:-1,insertViews:[{page:e,params:t}],opts:i},s)}insert(e,t,i,s,n){return this.queueTrns({insertStart:e,insertViews:[{page:t,params:i}],opts:s},n)}insertPages(e,t,i,s){return this.queueTrns({insertStart:e,insertViews:t,opts:i},s)}pop(e,t){return this.queueTrns({removeStart:-1,removeCount:1,opts:e},t)}popTo(e,t,i){const s={removeStart:-1,removeCount:-1,opts:t};return e instanceof r?(s.removeView=e,s.removeStart=1):"number"==typeof e&&(s.removeStart=e+1),this.queueTrns(s,i)}popToRoot(e,t){return this.queueTrns({removeStart:1,removeCount:-1,opts:e},t)}removeIndex(e,t=1,i,s){return this.queueTrns({removeStart:e,removeCount:t,opts:i},s)}setRoot(e,t,i,s){return this.setPages([{page:e,params:t}],i,s)}setPages(e,t,i){return t||(t={}),!0!==t.animated&&(t.animated=!1),this.queueTrns({insertStart:0,insertViews:e,removeStart:0,removeCount:-1,opts:t},i)}setRouteId(e,t,i){const s=this.getActive();if(o(s,e,t))return Promise.resolve({changed:!1,element:s.element});let n;const r=new Promise(e=>n=e);let a;const h={updateURL:!1,viewIsReady:e=>{let t;const i=new Promise(e=>t=e);return n({changed:!0,element:e,markVisible:async()=>{t(),await a}}),i}};if(0===i)a=this.setRoot(e,t,h);else{const s=this.views.find(i=>o(i,e,t));s?a=this.popTo(s,Object.assign({},h,{direction:"back"})):1===i?a=this.push(e,t,h):-1===i&&(a=this.setRoot(e,t,Object.assign({},h,{direction:"back",animated:!0})))}return r}getRouteId(){const e=this.getActive();return e?{id:e.element.tagName,params:e.params,element:e.element}:void 0}canGoBack(e=this.getActive()){return!(!e||!this.getPrevious(e))}getActive(){return this.views[this.views.length-1]}getByIndex(e){return this.views[e]}getPrevious(e=this.getActive()){if(!e)return;const t=this.views,i=t.indexOf(e);return i>0?t[i-1]:void 0}length(){return this.views.length}queueTrns(e,t){const i=new Promise((t,i)=>{e.resolve=t,e.reject=i});return e.done=t,e.insertViews&&0===e.insertViews.length&&(e.insertViews=void 0),this.transInstr.push(e),this.nextTrns(),i}success(e,t){if(null!==this.transInstr){if(t.done&&t.done(e.hasCompleted,e.requiresTransition,e.enteringView,e.leavingView,e.direction),t.resolve(e.hasCompleted),!1!==t.opts.updateURL&&this.useRouter){const t=this.win.document.querySelector("ion-router");if(t){const i="back"===e.direction?-1:1;t.navChanged(i)}}}else this.fireError("nav controller was destroyed",t)}failed(e,t){null!==this.transInstr?(this.transInstr.length=0,this.fireError(e,t)):this.fireError("nav controller was destroyed",t)}fireError(e,t){t.done&&t.done(!1,!1,e),t.reject&&!this.destroyed?t.reject(e):t.resolve(!1)}nextTrns(){if(this.isTransitioning)return!1;const e=this.transInstr.shift();return!!e&&(this.runTransition(e),!0)}async runTransition(e){try{this.ionNavWillChange.emit(),this.isTransitioning=!0,this.prepareTI(e);const t=this.getActive(),i=this.getEnteringView(e,t);if(!t&&!i)throw new Error("no views in the stack to be removed");i&&1===i.state&&await i.init(this.el),this.postViewInit(i,t,e);const s=(e.enteringRequiresTransition||e.leavingRequiresTransition)&&i!==t?await this.transition(i,t,e):{hasCompleted:!0,requiresTransition:!1};this.success(s,e),this.ionNavDidChange.emit()}catch(t){this.failed(t,e)}this.isTransitioning=!1,this.nextTrns()}prepareTI(e){const t=this.views.length;if(e.opts=e.opts||{},void 0===e.opts.delegate&&(e.opts.delegate=this.delegate),null!=e.removeView){e.removeStart,e.removeCount;const t=this.views.indexOf(e.removeView);if(t<0)throw new Error("removeView was not found");e.removeStart+=t}null!=e.removeStart&&(e.removeStart<0&&(e.removeStart=t-1),e.removeCount<0&&(e.removeCount=t-e.removeStart),e.leavingRequiresTransition=e.removeCount>0&&e.removeStart+e.removeCount===t),e.insertViews&&((e.insertStart<0||e.insertStart>t)&&(e.insertStart=t),e.enteringRequiresTransition=e.insertStart===t);const i=e.insertViews;if(!i)return;i.length;const s=i.map(e=>e instanceof r?e:"page"in e?a(e.page,e.params):a(e,void 0)).filter(e=>null!==e);if(0===s.length)throw new Error("invalid views to insert");for(const t of s){t.delegate=e.opts.delegate;const i=t.nav;if(i&&i!==this)throw new Error("inserted view was already inserted");if(3===t.state)throw new Error("inserted view was already destroyed")}e.insertViews=s}getEnteringView(e,t){const i=e.insertViews;if(i)return i[i.length-1];const s=e.removeStart;if(null!=s){const i=this.views,n=s+e.removeCount;for(let e=i.length-1;e>=0;e--){const r=i[e];if((e<s||e>=n)&&r!==t)return r}}}postViewInit(e,t,i){i.resolve,i.reject;const n=i.opts,r=i.insertViews,o=i.removeStart,a=i.removeCount;let h=void 0;if(null!=o&&null!=a){h=[];for(let i=0;i<a;i++){const s=this.views[i+o];s&&s!==e&&s!==t&&h.push(s)}n.direction=n.direction||"back"}if(0===this.views.length+(r?r.length:0)-(a||0))throw console.warn("You can't remove all the pages in the navigation stack. nav.pop() is probably called too many times.",this,this.el),new Error("navigation stack needs at least one root page");if(r){let e=i.insertStart;for(const t of r)this.insertViewAt(t,e),e++;i.enteringRequiresTransition&&(n.direction=n.direction||"forward")}if(h&&h.length>0){for(const e of h)s(this.win,e.element,"ionViewWillLeave"),s(this.win,e.element,"ionViewDidLeave"),s(this.win,e.element,"ionViewWillUnload");for(const e of h)this.destroyView(e)}}async transition(e,t,i){this.sbTrns&&(this.sbTrns.destroy(),this.sbTrns=void 0);const s=i.opts,r=s.progressAnimation?e=>{this.sbTrns=e}:void 0,o=e.element,a=t&&t.element,h=Object.assign({mode:this.mode,animated:this.animated,showGoBack:this.canGoBack(e),animationCtrl:this.animationCtrl,progressCallback:r,window:this.win,baseEl:this.el,enteringEl:o,leavingEl:a},s),l=await n(h);return this.transitionFinish(l,e,t,s)}transitionFinish(e,t,i,s){const n=!e||e.hasCompleted,r=n?t:i;return r&&this.cleanup(r),e&&e.destroy(),{hasCompleted:n,requiresTransition:!0,enteringView:t,leavingView:i,direction:s.direction}}insertViewAt(e,t){const i=this.views,s=i.indexOf(e);s>-1?(e.nav,i.splice(t,0,i.splice(s,1)[0])):(e.nav,e.nav=this,i.splice(t,0,e))}removeView(e){2===e.state||e.state;const t=this.views,i=t.indexOf(e);i>=0&&t.splice(i,1)}destroyView(e){e._destroy(),this.removeView(e)}cleanup(e){if(this.destroyed)return;const t=this.views,i=t.indexOf(e);for(let e=t.length-1;e>=0;e--){const n=t[e];e>i?(s(this.win,n.element,"ionViewWillUnload"),this.destroyView(n)):e<i&&(n.element.hidden=!0)}}swipeBackStart(){this.isTransitioning||this.transInstr.length>0||this.queueTrns({removeStart:-1,removeCount:1,opts:{direction:"back",progressAnimation:!0}},void 0)}swipeBackProgress(e){if(this.sbTrns){this.isTransitioning=!0;const t=e.deltaX/this.win.innerWidth;this.sbTrns.progressStep(t)}}swipeBackEnd(e){if(this.sbTrns){const t=e.deltaX,i=this.win.innerWidth,s=t/i,n=e.velocityX,r=i/2,o=n>=0&&(n>.2||e.deltaX>r),a=(o?1-s:s)*i;let h=0;if(a>5){const e=a/Math.abs(n);h=Math.min(e,300)}this.sbTrns.progressEnd(o,s,h)}}canSwipeBack(){return!!this.swipeBackEnabled&&!this.isTransitioning&&this.canGoBack()}render(){return[this.swipeBackEnabled&&e("ion-gesture",{canStart:this.canSwipeBack.bind(this),onStart:this.swipeBackStart.bind(this),onMove:this.swipeBackProgress.bind(this),onEnd:this.swipeBackEnd.bind(this),gestureName:"goback-swipe",gesturePriority:10,direction:"x",threshold:10,attachTo:"body"}),"ios"===this.mode&&e("div",{class:"nav-decor"}),e("slot",null)]}static get is(){return"ion-nav"}static get properties(){return{animated:{type:Boolean,attr:"animated",mutable:!0},animationCtrl:{connect:"ion-animation-controller"},canGoBack:{method:!0},config:{context:"config"},delegate:{type:"Any",attr:"delegate"},el:{elementRef:!0},getActive:{method:!0},getByIndex:{method:!0},getPrevious:{method:!0},getRouteId:{method:!0},insert:{method:!0},insertPages:{method:!0},length:{method:!0},pop:{method:!0},popTo:{method:!0},popToRoot:{method:!0},push:{method:!0},queue:{context:"queue"},removeIndex:{method:!0},root:{type:String,attr:"root",watchCallbacks:["rootChanged"]},rootParams:{type:"Any",attr:"root-params"},setPages:{method:!0},setRoot:{method:!0},setRouteId:{method:!0},swipeBackEnabled:{type:Boolean,attr:"swipe-back-enabled",mutable:!0},win:{context:"window"}}}static get events(){return[{name:"ionNavWillLoad",method:"ionNavWillLoad",bubbles:!0,cancelable:!0,composed:!0},{name:"ionNavWillChange",method:"ionNavWillChange",bubbles:!0,cancelable:!0,composed:!0},{name:"ionNavDidChange",method:"ionNavDidChange",bubbles:!0,cancelable:!0,composed:!0}]}}export{h as IonNav};