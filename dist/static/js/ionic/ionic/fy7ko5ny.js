/*!
 * (C) Ionic http://ionicframework.com - MIT License
 * Built with http://stenciljs.com
 */
const{h:t}=window.Ionic,s=function(t){const s=["webkitTransform","-webkit-transform","webkit-transform","transform"].find(s=>void 0!==t.style[s])||"transform",e=["webkitTransition","transition"].find(s=>void 0!==t.style[s])||"transition",i=e.indexOf("webkit")>-1?"-webkit-":"";return{transitionDurationProp:i+"transition-duration",transitionTimingFnProp:i+"transition-timing-function",transformProp:s,transitionProp:e}}(document.documentElement),e=/(^-?\d*\.?\d*)(.*)/,i=32,n=400,r={translateX:1,translateY:1,translateZ:1,scale:1,scaleX:1,scaleY:1,scaleZ:1,rotate:1,rotateX:1,rotateY:1,rotateZ:1,skewX:1,skewY:1,perspective:1},h=window.requestAnimationFrame||(t=>t());class o{constructor(){this._hasDur=!1,this._hasTweenEffect=!1,this._isAsync=!1,this._isReverse=!1,this._destroyed=!1,this.hasChildren=!1,this.isPlaying=!1,this.hasCompleted=!1}addElement(t){if(t)if(t.length)for(let s=0;s<t.length;s++)this._addEl(t[s]);else this._addEl(t);return this}_addEl(t){1===t.nodeType&&(this._elements=this._elements||[]).push(t)}add(t){return t.parent=this,this.hasChildren=!0,(this._childAnimations=this._childAnimations||[]).push(t),this}getDuration(t){return t&&null!=t.duration?t.duration:null!=this._duration?this._duration:this.parent?this.parent.getDuration():0}isRoot(){return!this.parent}duration(t){return this._duration=t,this}getEasing(){return this._isReverse&&this._reversedEasingName?this._reversedEasingName:null!=this._easingName?this._easingName:this.parent&&this.parent.getEasing()||null}easing(t){return this._easingName=t,this}easingReverse(t){return this._reversedEasingName=t,this}from(t,s){return this._addProp("from",t,s),this}to(t,e,i){const n=this._addProp("to",t,e);return i&&this.afterClearStyles([n.trans?s.transformProp:t]),this}fromTo(t,s,e,i){return this.from(t,s).to(t,e,i)}_getProp(t){if(this._fxProperties)return this._fxProperties.find(s=>s.effectName===t)}_addProp(t,i,n){let h=this._getProp(i);if(!h){const t=1===r[i];h={effectName:i,trans:t,wc:t?s.transformProp:i},(this._fxProperties=this._fxProperties||[]).push(h)}const o={val:n,num:0,effectUnit:""};if(h[t]=o,"string"==typeof n&&n.indexOf(" ")<0){const t=n.match(e);if(t){const s=parseFloat(t[1]);isNaN(s)||(o.num=s),o.effectUnit=t[0]!==t[2]?t[2]:""}}else"number"==typeof n&&(o.num=n);return h}beforeAddClass(t){return(this._beforeAddClasses=this._beforeAddClasses||[]).push(t),this}beforeRemoveClass(t){return(this._beforeRemoveClasses=this._beforeRemoveClasses||[]).push(t),this}duringAddClass(t){return this.beforeAddClass(t),this.afterRemoveClass(t),this}beforeStyles(t){return this._beforeStyles=t,this}beforeClearStyles(t){this._beforeStyles=this._beforeStyles||{};for(let s=0;s<t.length;s++)this._beforeStyles[t[s]]="";return this}beforeAddRead(t){return(this._readCallbacks=this._readCallbacks||[]).push(t),this}beforeAddWrite(t){return(this._writeCallbacks=this._writeCallbacks||[]).push(t),this}afterAddClass(t){return(this._afterAddClasses=this._afterAddClasses||[]).push(t),this}afterRemoveClass(t){return(this._afterRemoveClasses=this._afterRemoveClasses||[]).push(t),this}afterStyles(t){return this._afterStyles=t,this}afterClearStyles(t){this._afterStyles=this._afterStyles||{};for(let s=0;s<t.length;s++)this._afterStyles[t[s]]="";return this}play(t){const s=this;s._destroyed||(s._isAsync=s._hasDuration(t),s._clearAsync(),s._playInit(t),h(()=>{h(()=>{s._playDomInspect(t)})}))}playAsync(t){return new Promise(s=>(this.onFinish(s,{oneTimeCallback:!0,clearExistingCallacks:!0}),this.play(t),this))}playSync(){if(!this._destroyed){const t={duration:0};this._isAsync=!1,this._clearAsync(),this._playInit(t),this._playDomInspect(t)}}_playInit(t){this._hasTweenEffect=!1,this.isPlaying=!0,this.hasCompleted=!1,this._hasDur=this.getDuration(t)>i;const s=this._childAnimations;if(s)for(let e=0;e<s.length;e++)s[e]._playInit(t);this._hasDur&&(this._progress(0),this._willChange(!0))}_playDomInspect(t){const s=this;s._beforeAnimation();const e=s.getDuration(t);s._isAsync&&s._asyncEnd(e,!0),s._playProgress(t),s._isAsync&&!this._destroyed&&h(()=>{s._playToStep(1)})}_playProgress(t){const s=this._childAnimations;if(s)for(let e=0;e<s.length;e++)s[e]._playProgress(t);this._hasDur?this._setTrans(this.getDuration(t),!1):(this._progress(1),this._setAfterStyles(),this._didFinish(!0))}_playToStep(t){if(!this._destroyed){const s=this._childAnimations;if(s)for(let e=0;e<s.length;e++)s[e]._playToStep(t);this._hasDur&&this._progress(t)}}_asyncEnd(t,s){const e=this;e._unregisterTrnsEnd=function(t,s){let e;const i={passive:!0};function n(){e&&e()}function r(e){t===e.target&&(n(),s(e))}return t&&(t.addEventListener("webkitTransitionEnd",r,i),t.addEventListener("transitionend",r,i),e=function(){t.removeEventListener("webkitTransitionEnd",r,i),t.removeEventListener("transitionend",r,i)}),n}(e._transEl(),function(){e._clearAsync(),e._playEnd(),e._didFinishAll(s,!0,!1)}),e._timerId=setTimeout(function(){e._timerId=void 0,e._clearAsync(),e._playEnd(s?1:0),e._didFinishAll(s,!0,!1)},t+n)}_playEnd(t){const s=this._childAnimations;if(s)for(let e=0;e<s.length;e++)s[e]._playEnd(t);this._hasDur&&(null!==t&&void 0!==t&&(this._setTrans(0,!0),this._progress(t)),this._setAfterStyles(),this._willChange(!1))}_hasDuration(t){if(this.getDuration(t)>i)return!0;const s=this._childAnimations;if(s)for(let e=0;e<s.length;e++)if(s[e]._hasDuration(t))return!0;return!1}_hasDomReads(){if(this._readCallbacks&&this._readCallbacks.length)return!0;const t=this._childAnimations;if(t)for(let s=0;s<t.length;s++)if(t[s]._hasDomReads())return!0;return!1}stop(t){void 0===t&&(t=1),this._clearAsync(),this._hasDur=!0,this._playEnd(t)}_clearAsync(){this._unregisterTrnsEnd&&this._unregisterTrnsEnd(),this._timerId&&clearTimeout(this._timerId),this._timerId=this._unregisterTrnsEnd=void 0}_progress(t){let e;const i=this._elements,n=this._fxProperties;if(!i||0===i.length||!n||this._destroyed)return;this._isReverse&&(t=1-t);let r,h=0,o=0,a="";for(h=0;h<n.length;h++)if((r=n[h]).from&&r.to){const s=r.from.num,n=r.to.num,h=s!==n;if(h&&(this._hasTweenEffect=!0),0===t?e=r.from.val:1===t?e=r.to.val:h&&(e=(n-s)*t+s+r.to.effectUnit),null!==e){const t=r.effectName;if(r.trans)a+=t+"("+e+") ";else for(o=0;o<i.length;o++)i[o].style[t]=e}}if(a.length)for((!this._isReverse&&1!==t||this._isReverse&&0!==t)&&(a+="translateZ(0px)"),h=0;h<i.length;h++)i[h].style[s.transformProp]=a}_setTrans(t,e){const i=this._elements;if(!i||0===i.length||!this._fxProperties)return;const n=e?"linear":this.getEasing(),r=t+"ms",h=s.transitionProp,o=s.transitionDurationProp,a=s.transitionTimingFnProp;let l;for(let s=0;s<i.length;s++)l=i[s].style,t>0?(l[h]="",l[o]=r,n&&(l[a]=n)):l[h]="none"}_beforeAnimation(){this._fireBeforeReadFunc(),this._fireBeforeWriteFunc(),this._setBeforeStyles()}_setBeforeStyles(){const t=this._childAnimations;if(t)for(let s=0;s<t.length;s++)t[s]._setBeforeStyles();const s=this._elements;if(!s||0===s.length||this._isReverse)return;const e=this._beforeAddClasses,i=this._beforeRemoveClasses;for(let t=0;t<s.length;t++){const n=s[t],r=n.classList;if(e)for(let t=0;t<e.length;t++)r.add(e[t]);if(i)for(let t=0;t<i.length;t++)r.remove(i[t]);if(this._beforeStyles)for(const t in this._beforeStyles)n.style[t]=this._beforeStyles[t]}}_fireBeforeReadFunc(){const t=this._childAnimations;if(t)for(let s=0;s<t.length;s++)t[s]._fireBeforeReadFunc();const s=this._readCallbacks;if(s)for(let t=0;t<s.length;t++)s[t]()}_fireBeforeWriteFunc(){const t=this._childAnimations;if(t)for(let s=0;s<t.length;s++)t[s]._fireBeforeWriteFunc();const s=this._writeCallbacks;if(s)for(let t=0;t<s.length;t++)s[t]()}_setAfterStyles(){let t,e,i,n;const r=this._elements;if(!r)return;let h;for(t=0;t<r.length;t++)if(n=(i=r[t]).classList,i.style[s.transitionDurationProp]=i.style[s.transitionTimingFnProp]="",this._isReverse){const t=this._beforeAddClasses;if(t)for(e=0;e<t.length;e++)n.remove(t[e]);const s=this._beforeRemoveClasses;if(s)for(e=0;e<s.length;e++)n.add(s[e]);const r=this._beforeStyles;if(r)for(h in r)i.style[h]=""}else{const t=this._afterAddClasses;if(t)for(e=0;e<t.length;e++)n.add(t[e]);const s=this._afterRemoveClasses;if(s)for(e=0;e<s.length;e++)n.remove(s[e]);const r=this._afterStyles;if(r)for(h in r)i.style[h]=r[h]}}_willChange(t){let s;const e=this._fxProperties;let i;if(t&&e){s=[];for(let t=0;t<e.length;t++){const i=e[t].wc;"webkitTransform"===i?s.push("transform","-webkit-transform"):i&&s.push(i)}i=s.join(",")}else i="";const n=this._elements;if(n)for(let t=0;t<n.length;t++)n[t].style.willChange=i}progressStart(){this._clearAsync(),this._beforeAnimation(),this._progressStart()}_progressStart(){const t=this._childAnimations;if(t)for(let s=0;s<t.length;s++)t[s]._progressStart();this._setTrans(0,!0),this._willChange(!0)}progressStep(t){t=Math.min(1,Math.max(0,t));const s=this._childAnimations;if(s)for(let e=0;e<s.length;e++)s[e].progressStep(t);this._progress(t)}progressEnd(t,s,e){this._isReverse&&(s=1-s);const i=t?1:0,n=Math.abs(s-i);void 0===e&&(e=-1),e<0?e=this._duration||0:n<.05&&(e=0),this._isAsync=e>30,this._progressEnd(t,i,e,this._isAsync),this._isAsync&&(this._asyncEnd(e,t),this._destroyed||h(()=>{this._playToStep(i)}))}_progressEnd(t,s,e,i){const n=this._childAnimations;if(n)for(let r=0;r<n.length;r++)n[r]._progressEnd(t,s,e,i);i?(this.isPlaying=!0,this.hasCompleted=!1,this._hasDur=!0,this._willChange(!0),this._setTrans(e,!1)):(this._progress(s),this._willChange(!1),this._setAfterStyles(),this._didFinish(t))}onFinish(t,s){return s&&s.clearExistingCallacks&&(this._onFinishCallbacks=this._onFinishOneTimeCallbacks=void 0),s&&s.oneTimeCallback?(this._onFinishOneTimeCallbacks=this._onFinishOneTimeCallbacks||[],this._onFinishOneTimeCallbacks.push(t)):(this._onFinishCallbacks=this._onFinishCallbacks||[],this._onFinishCallbacks.push(t)),this}_didFinishAll(t,s,e){const i=this._childAnimations;if(i)for(let n=0;n<i.length;n++)i[n]._didFinishAll(t,s,e);(s&&this._isAsync||e&&!this._isAsync)&&this._didFinish(t)}_didFinish(t){if(this.isPlaying=!1,this.hasCompleted=t,this._onFinishCallbacks)for(let t=0;t<this._onFinishCallbacks.length;t++)this._onFinishCallbacks[t](this);if(this._onFinishOneTimeCallbacks){for(let t=0;t<this._onFinishOneTimeCallbacks.length;t++)this._onFinishOneTimeCallbacks[t](this);this._onFinishOneTimeCallbacks.length=0}}reverse(t){void 0===t&&(t=!0);const s=this._childAnimations;if(s)for(let e=0;e<s.length;e++)s[e].reverse(t);return this._isReverse=!!t,this}destroy(){this._destroyed=!0;const t=this._childAnimations;if(t)for(let s=0;s<t.length;s++)t[s].destroy();this._clearAsync(),this._elements&&(this._elements.length=0),this._readCallbacks&&(this._readCallbacks.length=0),this._writeCallbacks&&(this._writeCallbacks.length=0),this.parent=void 0,this._childAnimations&&(this._childAnimations.length=0),this._onFinishCallbacks&&(this._onFinishCallbacks.length=0),this._onFinishOneTimeCallbacks&&(this._onFinishOneTimeCallbacks.length=0)}_transEl(){const t=this._childAnimations;if(t)for(let s=0;s<t.length;s++){const e=t[s]._transEl();if(e)return e}return this._hasTweenEffect&&this._hasDur&&this._elements&&this._elements.length>0?this._elements[0]:null}}class a{create(t,s,e){return t?t(o,s,e):Promise.resolve(new o)}static get is(){return"ion-animation-controller"}static get properties(){return{create:{method:!0}}}}export{a as IonAnimationController};